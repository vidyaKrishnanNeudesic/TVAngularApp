<div class="review-form">
  <!-- <div class="cast-crew-header">
        <button mat-stroked-button color="primary" class="back-btn" (click)="goShowDetails()">&#8592; Back to Details</button>
</div> -->
  <h3>Reviews</h3>
  <form #reviewForm="ngForm" (submit)="submitReview($event)">
    <mat-form-field appearance="fill">
      <mat-label>Leave Rating</mat-label>
      <mat-select [value]="rating()" (selectionChange)="rating.set($event.value)" required>
        @for (r of [1, 2, 3, 4, 5]; track r) {
          <mat-option [value]="r">{{ r }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Comment</mat-label>
      <textarea
        matInput
        #commentInput="ngModel"
        required
        minlength="3"
      maxlength="50"
      name="comment"
      [(ngModel)]="commentValue"
      (ngModelChange)="comment.set($event)"
      ></textarea>
      <mat-error *ngIf="commentInput.invalid && (commentInput.dirty || commentInput.touched)">
  <ng-container *ngIf="commentInput.errors?.['required']">
    Comment is required.
  </ng-container>
  <ng-container *ngIf="commentInput.errors?.['minlength']">
    Comment must be at least 3 characters.
  </ng-container>
  <ng-container *ngIf="commentInput.errors?.['maxlength']">
    Comment cannot exceed 50 characters.
  </ng-container>
</mat-error>
    </mat-form-field>
    <input type="hidden" [value]="showId" name="showId" />
    <button mat-raised-button color="primary" type="submit" [disabled]="!rating() || !commentValue || commentValue.length < 3 || commentValue.length > 50">
      @if (editingId()) {
        Update Review
      } @else {
        Add Review
      }
    </button>
  </form>
</div>
@if (reviews().length > 0) {
  <div class="review-list">
    <h3>User Reviews</h3>
    @for (review of reviews(); track review.id) {
      <mat-card>
        <div><strong>Rating:</strong> {{ review.rating }}</div>
        <div><strong>Comment:</strong> {{ review.comment }}</div>
        <button mat-button color="primary" (click)="editReview(review)">Update</button>
        <button mat-button color="warn" (click)="deleteReview(review.id)">Delete</button>
      </mat-card>
    }
  </div>
}
